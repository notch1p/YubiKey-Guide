这是一篇利用 [YubiKey](https://www.yubico.com/products/yubikey-hardware/) 作为 [智能卡](https://security.stackexchange.com/questions/38924/how-does-storing-gpg-ssh-private-keys-on-smart-cards-compare-to-plain-usb-drives) 来存储GPG加密、签名、认证密钥（亦可用于SSH认证）的指南。本文档中说明的许多原理对其他智能卡设备同样适用。

存储在Yubikey上的密钥是[不可导出的](https://support.yubico.com/support/solutions/articles/15000010242-can-i-duplicate-or-back-up-a-yubikey-)（与以文件形式存储在磁盘上的相对），日常使用十分方便。比起需要记住密码来解锁SSH/GPG密钥，我们只需利用PIN解锁Yubikey并触摸其表面的按键即可。所有签名/加密操作都发生在智能卡上，而非本机内存。

**New!** [drduh/Purse](https://github.com/drduh/Purse)是一个使用GPG和Yubikey的密码管理器。

>**安全信息**：如果您在 2021年1月份前阅读了本篇指南，您的 GPG *PIN*与 *Admin PIN* 可能提前设置了对应的默认值（`123456` 与 `12345678`）。这将允许攻击者随意使用您的Yubikey或是重置其PIN。请移步[更改PIN](#change-pin)查看详细信息。

如果您有评论或是建议，请在Github上提[Issue](https://github.com/drduh/YubiKey-Guide/issues)。

- [购买](#purchase)
- [环境准备](#prepare-environment)
- [软件需求](#required-software)
  * [Debian and Ubuntu](#debian-and-ubuntu)
  * [Arch](#arch)
  * [RHEL7](#rhel7)
  * [NixOS](#nixos)
  * [OpenBSD](#openbsd)
  * [macOS](#macos)
  * [Windows](#windows)
- [熵](#entropy)
- [创建密钥对](#creating-keys)
  * [临时工作目录](#temporary-working-directory)
  * [加强配置](#harden-configuration)
- [主钥（master key）](#master-key)
- [利用现有密钥签名](#sign-with-existing-key)
- [子钥（sub-key）](#sub-keys)
  * [签名](#signing)
  * [加密](#encryption)
  * [认证](#authentication)
  * [增加额外身份信息](#add-extra-identities)
- [验证](#verify)
- [导出密钥](#export-secret-keys)
- [吊销证书](#revocation-certificate)
- [备份](#backup)
- [导出公钥](#export-public-keys)
- [配置智能卡](#configure-smartcard)
  * [更改PIN](#change-pin)
  * [启用KDF](#enable-kdf)
  * [设置信息](#set-information)
- [移动密钥](#transfer-keys)
  * [签名](#signing-1)
  * [加密](#encryption-1)
  * [认证](#authentication-1)
- [验证智能卡](#verify-card)
- [多个Yubikey](#multiple-yubikeys)
- [清理](#cleanup)
- [使用密钥](#using-keys)
- [Rotating keys](#rotating-keys)
  * [准备环境](#setup-environment)
  * [子钥续期](#renewing-sub-keys)
  * [Rotating keys](#rotating-keys-1)
- [增加注记](#adding-notations)
- [SSH](#ssh)
  * [创建配置](#create-configuration)
  * [替换agents](#replace-agents)
  * [复制公钥](#copy-public-key)
  * [（可选）为身份信息文件配置保存公钥](#optional-save-public-key-for-identity-file-configuration)
  * [通过公钥验证连接](#connect-with-public-key-authentication)
  * [导入SSH密钥](#import-ssh-keys)
  * [远程主机 (SSH Agent转发)](#remote-machines-ssh-agent-forwarding)
    - [使用ssh-agent](#use-ssh-agent)
    - [使用 S.gpg-agent.ssh](#use-sgpg-agentssh)
    - [链式SSH Agent转发](#chained-ssh-agent-forwarding)
  * [GitHub](#github)
  * [OpenBSD](#openbsd-1)
  * [Windows](#windows-1)
    + [WSL](#wsl)
      - [使用 ssh-agent 或 S.weasel-pegant](#use-ssh-agent-or-use-sweasel-pegant)
      - [前提条件](#prerequisites)
      - [WSL配置](#wsl-configuration)
      - [远程主机配置](#remote-host-configuration)
  * [macOS](#macos-1)
- [远程主机 (GPG Agent 转发)](#remote-machines-gpg-agent-forwarding)
  * [老版本系统需要的步骤](#steps-for-older-distributions)
  * [链式 GPG Agent 转发](#chained-gpg-agent-forwarding)
- [使用多个密钥](#using-multiple-keys)
- [需要触摸](#require-touch)
- [Email](#email)
  * [Mailvelope on macOS](#mailvelope-on-macos)
  * [Mutt](#mutt)
- [重置](#reset)
- [重置后恢复](#recovery-after-reset)
- [注释](#notes)
- [疑难解答](#troubleshooting)
- [替代方案](#alternatives)
- [链接](#links)